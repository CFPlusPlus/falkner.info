---
type Props = {
  href?: string;
  target?: string;
  rel?: string;
  variant?: "primary" | "secondary" | "ghost";
  class?: string;
  ariaLabel?: string;
  id?: string;
};

const { href, target, rel, variant = "primary", class: className = "", ariaLabel, ...rest } =
  Astro.props as Props;

// Base-URL (wichtig, wenn die Seite in einem Unterordner deployed wird)
const baseUrl = import.meta.env.BASE_URL;
const resolvedHref = href
  ? href.startsWith("/") && !href.startsWith(baseUrl)
    ? `${baseUrl}${href.slice(1)}`
    : href
  : undefined;

const isBlankTarget = target?.toLowerCase() === "_blank";

// Bei externen Tabs immer sichere rel-Token erzwingen und Duplikate vermeiden.
const resolvedRel = (() => {
  if (!isBlankTarget) return rel;

  const inputTokens = (rel || "").split(/\s+/).filter(Boolean);
  const uniqueTokens: string[] = [];
  const seen = new Set<string>();

  for (const token of inputTokens) {
    const normalized = token.toLowerCase();
    if (seen.has(normalized)) continue;
    seen.add(normalized);
    uniqueTokens.push(token);
  }

  if (!seen.has("noopener")) uniqueTokens.push("noopener");
  if (!seen.has("noreferrer")) uniqueTokens.push("noreferrer");

  return uniqueTokens.join(" ");
})();

const base =
  "inline-flex items-center justify-center gap-2 rounded-[var(--r-control)] px-4 py-2 text-sm font-medium border transition-[color,background-color,border-color,transform] duration-200";

const variants = {
  primary:
    "bg-accent/15 border-accent/40 text-text hover:bg-accent/20 hover:border-accent/55 active:translate-y-[0.5px]",
  secondary:
    "bg-surface/60 border-border/70 text-text hover:bg-surface/80 hover:border-border active:translate-y-[0.5px]",
  ghost:
    "bg-transparent border-transparent text-muted hover:text-text hover:bg-surface/40 active:translate-y-[0.5px]"
} as const;

const cls = `${base} ${variants[variant]} ${className}`;
---
{href ? (
  <a href={resolvedHref} target={target} rel={resolvedRel} class={cls} aria-label={ariaLabel} {...rest}>
    <slot />
  </a>
) : (
  <button type="button" class={cls} aria-label={ariaLabel} {...rest}>
    <slot />
  </button>
)}
